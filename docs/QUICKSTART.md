# ğŸš€ x402 æ”¯ä»˜ä¸­é—´ä»¶å¿«é€Ÿå¼€å§‹æŒ‡å—

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. å·²å®‰è£…çš„åŒ…
- âœ… `x402-next` - Next.js æ”¯ä»˜ä¸­é—´ä»¶
- âœ… `@coinbase/x402` - Coinbase ä¸»ç½‘ facilitator

### 2. å·²åˆ›å»ºçš„æ–‡ä»¶

#### æ ¸å¿ƒæ–‡ä»¶
- **`middleware.ts`** - æ”¯ä»˜ä¸­é—´ä»¶ä¸»é…ç½®æ–‡ä»¶
  - é…ç½®äº†ä¸¤ä¸ªå—ä¿æŠ¤çš„è·¯ç”±ç¤ºä¾‹
  - ä½¿ç”¨ Base Sepolia æµ‹è¯•ç½‘
  - é›†æˆäº†æµ‹è¯• facilitator

#### ç¤ºä¾‹é¡µé¢å’Œ API
- **`app/page.tsx`** - ä¸»é¡µï¼ˆå±•ç¤ºé…ç½®ä¿¡æ¯å’Œå¯¼èˆªï¼‰
- **`app/protected/page.tsx`** - å—ä¿æŠ¤çš„ç¤ºä¾‹é¡µé¢ï¼ˆ$0.01ï¼‰
- **`app/api/premium/route.ts`** - å—ä¿æŠ¤çš„ API ç«¯ç‚¹ï¼ˆ$0.05ï¼‰

#### æ–‡æ¡£å’Œç¤ºä¾‹
- **`README-X402.md`** - å®Œæ•´é…ç½®æ–‡æ¡£
- **`middleware.config.example.ts`** - é…ç½®ç¤ºä¾‹ï¼ˆåŒ…å«æµ‹è¯•ç½‘å’Œä¸»ç½‘ï¼‰
- **`types/x402.d.ts`** - TypeScript ç±»å‹å®šä¹‰

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

### ç¬¬ 1 æ­¥ï¼šé…ç½®é’±åŒ…åœ°å€ âš ï¸ é‡è¦

æ‰“å¼€ `middleware.ts`ï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œï¼š

```typescript
export const middleware = paymentMiddleware(
  "0xYourAddress", // ğŸ‘ˆ åœ¨è¿™é‡Œæ›¿æ¢ä¸ºæ‚¨çš„é’±åŒ…åœ°å€
```

**æ›¿æ¢ä¸ºæ‚¨çš„å®é™…é’±åŒ…åœ°å€**

- æµ‹è¯•ç¯å¢ƒï¼šä½¿ç”¨ Base Sepolia æµ‹è¯•ç½‘åœ°å€
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨çœŸå®çš„ä¸»ç½‘åœ°å€

### ç¬¬ 2 æ­¥ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# ç¡®ä¿åœ¨é¡¹ç›®ç›®å½•ä¸­
cd c:\Users\Administrator\Desktop\æ–°å»ºæ–‡ä»¶å¤¹

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ç¬¬ 3 æ­¥ï¼šæµ‹è¯•æ”¯ä»˜æµç¨‹

è®¿é—®ä»¥ä¸‹ URL æµ‹è¯•ï¼š

1. **ä¸»é¡µ**: http://localhost:3000
   - æŸ¥çœ‹é…ç½®ä¿¡æ¯å’Œè¯´æ˜

2. **å—ä¿æŠ¤é¡µé¢**: http://localhost:3000/protected
   - éœ€è¦æ”¯ä»˜ $0.01
   - ä½¿ç”¨ Base Sepolia æµ‹è¯•ç½‘

3. **é«˜çº§ API**: http://localhost:3000/api/premium
   - éœ€è¦æ”¯ä»˜ $0.05
   - è¿”å› JSON æ•°æ®

### ç¬¬ 4 æ­¥ï¼šè·å–æµ‹è¯•ä»£å¸

ä¸ºäº†åœ¨æµ‹è¯•ç½‘è¿›è¡Œæµ‹è¯•ï¼Œæ‚¨éœ€è¦ï¼š

1. **Base Sepolia æµ‹è¯•å¸**
   - è®¿é—® Base Sepolia faucet
   - è·å–å…è´¹çš„æµ‹è¯• ETH

2. **Solana Devnet ä»£å¸**ï¼ˆå¦‚æœä½¿ç”¨ Solanaï¼‰
   - ä½¿ç”¨ Solana CLI: `solana airdrop 1`
   - æˆ–è®¿é—® Solana devnet faucet

### ç¬¬ 5 æ­¥ï¼šè‡ªå®šä¹‰é…ç½®

ç¼–è¾‘ `middleware.ts` æ¥ï¼š

- âœï¸ ä¿®æ”¹ä»·æ ¼
- âœï¸ æ·»åŠ æ›´å¤šå—ä¿æŠ¤çš„è·¯ç”±
- âœï¸ è‡ªå®šä¹‰æè¿°å’Œ schema
- âœï¸ è°ƒæ•´è¶…æ—¶è®¾ç½®

å‚è€ƒ `middleware.config.example.ts` æŸ¥çœ‹æ›´å¤šé…ç½®é€‰é¡¹ã€‚

## ğŸŒ åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆä¸»ç½‘ï¼‰

å‡†å¤‡å¥½æ¥å—çœŸå®æ”¯ä»˜æ—¶ï¼š

### æ­¥éª¤ 1ï¼šæ›´æ–° middleware.ts

```typescript
import { paymentMiddleware } from 'x402-next';
import { facilitator } from "@coinbase/x402"; // å–æ¶ˆæ³¨é‡Š

export const middleware = paymentMiddleware(
  "0xc61cd7032925603c63b2eb658e2b56faac351d24", // ä¸»ç½‘åœ°å€
  {
    '/protected': {
      price: '$0.01',
      network: "base-mainnet", // æ”¹ä¸ºä¸»ç½‘
      config: {
        description: 'Access to protected content',
      }
    },
  },
  facilitator({ network: 'mainnet' }) // ä½¿ç”¨ä¸»ç½‘ facilitator
);
```

### æ­¥éª¤ 2ï¼šæµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤é’±åŒ…åœ°å€æ­£ç¡®ï¼ˆä¸»ç½‘åœ°å€ï¼‰
- [ ] æ‰€æœ‰è·¯ç”±éƒ½ä½¿ç”¨ä¸»ç½‘ç½‘ç»œ
- [ ] Facilitator é…ç½®ä¸ºä¸»ç½‘
- [ ] åœ¨æµ‹è¯•ç½‘å……åˆ†æµ‹è¯•
- [ ] ä»·æ ¼è®¾ç½®åˆç†
- [ ] å®‰å…¨åœ°å­˜å‚¨ç§é’¥

## ğŸ“Š å·¥ä½œåŸç†

### æ”¯ä»˜æµç¨‹

1. **ç”¨æˆ·è®¿é—®å—ä¿æŠ¤è·¯ç”±**
   ```
   GET /protected
   ```

2. **ä¸­é—´ä»¶æ‹¦æˆªè¯·æ±‚**
   - æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„æ”¯ä»˜å‡­è¯
   - å¦‚æœæ²¡æœ‰ï¼Œè¿”å› HTTP 402

3. **è¿”å›æ”¯ä»˜è¯´æ˜**
   ```json
   {
     "error": "Payment Required",
     "price": "$0.01",
     "network": "base-sepolia",
     "paymentInstructions": { ... }
   }
   ```

4. **ç”¨æˆ·å®Œæˆæ”¯ä»˜**
   - é€šè¿‡é’±åŒ…æ”¯ä»˜
   - Facilitator éªŒè¯äº¤æ˜“

5. **è®¿é—®æˆæƒ**
   - æ”¯ä»˜éªŒè¯åï¼Œä¸­é—´ä»¶æ”¾è¡Œè¯·æ±‚
   - ç”¨æˆ·è·å¾—å†…å®¹è®¿é—®æƒé™

### HTTP 402 å“åº”

å½“ç”¨æˆ·æœªæ”¯ä»˜æ—¶ï¼Œä¼šæ”¶åˆ°ï¼š
- **çŠ¶æ€ç **: 402 Payment Required
- **å“åº”ä½“**: åŒ…å«æ”¯ä»˜è¯´æ˜å’Œä»·æ ¼ä¿¡æ¯

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ä¸­é—´ä»¶æ—¥å¿—

åœ¨ `middleware.ts` ä¸­æ·»åŠ æ—¥å¿—ï¼š

```typescript
export const middleware = paymentMiddleware(
  "0xYourAddress",
  routeConfigs,
  facilitatorConfig
);

// æ·»åŠ æ—¥å¿—åŒ…è£…
export default function wrappedMiddleware(request: NextRequest) {
  console.log('ğŸ”’ Payment middleware triggered:', request.url);
  return middleware(request);
}
```

### æ£€æŸ¥æ”¯ä»˜çŠ¶æ€

åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ï¼š
- 402 å“åº”
- æ”¯ä»˜è¯´æ˜
- äº¤æ˜“çŠ¶æ€

### å¸¸è§é—®é¢˜

**Q: æ”¶åˆ° 402 é”™è¯¯ä½†å·²ç»æ”¯ä»˜**
A: æ£€æŸ¥æ”¯ä»˜å‡­è¯æ˜¯å¦æ­£ç¡®ä¼ é€’ï¼ŒæŸ¥çœ‹ç½‘ç»œé…ç½®æ˜¯å¦åŒ¹é…

**Q: ä¸­é—´ä»¶ä¸ç”Ÿæ•ˆ**
A: æ£€æŸ¥ `config.matcher` æ˜¯å¦åŒ…å«æ‚¨çš„è·¯ç”±

**Q: facilitator è¿æ¥å¤±è´¥**
A: éªŒè¯ URL æˆ–ç½‘ç»œé…ç½®ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥

## ğŸ“š ç›¸å…³èµ„æº

- **å®Œæ•´æ–‡æ¡£**: æŸ¥çœ‹ `README-X402.md`
- **é…ç½®ç¤ºä¾‹**: æŸ¥çœ‹ `middleware.config.example.ts`
- **ç±»å‹å®šä¹‰**: æŸ¥çœ‹ `types/x402.d.ts`
- **å®˜æ–¹æ–‡æ¡£**: https://x402.org

## ğŸ’¡ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### 1. å†…å®¹ä»˜è´¹å¢™
```typescript
'/article/:id': {
  price: '$0.05',
  network: "base-sepolia",
  config: {
    description: 'è®¿é—®ä»˜è´¹æ–‡ç« ',
  }
}
```

### 2. API è°ƒç”¨é™åˆ¶
```typescript
'/api/ai-service': {
  price: '$0.10',
  network: "base-sepolia",
  config: {
    description: 'AI æœåŠ¡è°ƒç”¨ï¼ˆæ¯æ¬¡è¯·æ±‚ï¼‰',
    maxTimeoutSeconds: 120,
  }
}
```

### 3. ä¸‹è½½ä¿æŠ¤
```typescript
'/downloads/premium/:file': {
  price: '$1.00',
  network: "base-sepolia",
  config: {
    description: 'ä¸‹è½½é«˜çº§èµ„æº',
  }
}
```

## ğŸ‰ å¼€å§‹èµšå–åŠ å¯†è´§å¸ï¼

é…ç½®å®Œæˆåï¼Œæ‚¨å°±å¯ä»¥å¼€å§‹ï¼š
- ğŸš€ æ¥å—åŠ å¯†è´§å¸å¾®æ”¯ä»˜
- ğŸ’° ä¿æŠ¤æœ‰ä»·å€¼çš„å†…å®¹å’Œ API
- ğŸŒ æœåŠ¡å…¨çƒç”¨æˆ·ï¼ˆæ— éœ€ä¼ ç»Ÿæ”¯ä»˜ç½‘å…³ï¼‰
- âš¡ äº«å—å¿«é€Ÿã€ä½è´¹ç”¨çš„äº¤æ˜“

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ `README-X402.md` æˆ–è®¿é—® x402.org

